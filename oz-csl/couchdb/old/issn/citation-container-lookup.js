
//----------------------------------------------------------------------------------------
function finger_print(s) {
	s = s.toLowerCase();

	// stop words
	// en
	s = s.replace(/\bfor\b/g, '');
	s = s.replace(/\band\b/g, '')
	s = s.replace(/\bof\b/g, '');
	s = s.replace(/\bthe\b/g, '');
	s = s.replace(/\bin\b/g, '');

	// fr
	s = s.replace(/\bde\b/g, '');
	s = s.replace(/\bla\b/g, '');
	s = s.replace(/\bet\b/g, '');

	// de
	s = s.replace(/\bdas\b/g, '');
	s = s.replace(/\bder\b/g, '');
	s = s.replace(/\bfur\b/g, '');

	// numbers
	s = s.replace(/\d+/g, '');


	// white space
	s = s.replace(/\s\s*/g, '');

	// punctuation
	s = s.replace(/[\.|,|\'|\(|\)|"|:|-|&|-]+/g, '');

	return s;
}


//----------------------------------------------------------------------------------------
function (doc) {
 
	var x = [
'actaamazonica',
'actabiolparan',
'actabotacadscihung',
'actabotanicabrasilica',
'actabotanicaneerlandica',
'actabotborealoccidsin',
'actabotbrasil',
'actabotcroat',
'actabotgallica',
'actabotgallicabotlett',
'actabothung',
'actabotmalac',
'actabotmex',
'actabotneerl',
'actabotvenez',
'actabotyunnan',
'actahortiberg',
'actamanilana',
'actaphytotaxgeobot',
'actaphytotaxsin',
'actasocbotpoloniae',
'actualbiol',
'adansonia',
'adansoniaser',
'adansoniasér',
'africanjbiotech',
'aliso',
'allertonia',
'alpinebot',
'amerfernj',
'americanfernjournal',
'americanjournalbotany',
'amerjbot',
'amermidlnaturalist',
'amerorchidsocbull',
'analesdeljardínbotánicomadrid',
'analesinstbiolunivnacautónméxicobot',
'analesjardbotmadrid',
'annalesbotanicifennici',
'annbotfenn',
'annbotoxford',
'annbotrome',
'anncarnegiemus',
'annjardbotbuitenzorg',
'annmagnathist',
'annmissouribotgard',
'annmuscolmarseille',
'annnathist',
'annnaturhistmuswien',
'annnaturhistmuswienb',
'annnewyorkacadsci',
'annscinatbot',
'anntransvaalmus',
'anntsukubabotgard',
'annuaireconservjardbotgenève',
'aquaticbot',
'archivmusnacriojaneiro',
'archjardbotriojaneiro',
'archmusnacriojaneiro',
'arcula',
'arkbot',
'arkivbotstockh',
'arnaldoa',
'aroideana',
'arqmusnacriojaneiro',
'asklepios',
'australianjournalbotany',
'australiansystematicbotany',
'australjbot',
'australjbotsupplser',
'australorchidrev',
'australsystbot',
'austrobaileya',
'balduinia',
'bangladeshjpltaxon',
'bauhinia',
'beitrbiolpflanzen',
'belgjbot',
'berdeutschbotges',
'berschweizbotges',
'biodiversdataj',
'biodiversresconservation',
'bioldiversityconservation',
'bishopmusbullbot',
'blumea',
'blumeabiodiversityevolutionbiogeographyplants',
'blumeasuppl',
'boissiera',
'bolbotunivsaopaulo',
'boletimbotânica',
'bolinstbotunivguadalajara',
'bolmusgoeldihistnatethnogr',
'bolmushistnattucuman',
'bolmusparaenseemiliogoeldinsbot',
'bolsocbotméx',
'bolsocbotméxico',
'bonplandiacorrientes',
'bostonjnathist',
'botanicaljournallinneansociety',
'botanicalmagazinetokyo',
'botbullacadsin',
'botbullacadsintaipei',
'botgaz',
'bothalia',
'bothelv',
'botjahrbsyst',
'botjlinnsoc',
'botmag',
'botmagkewmag',
'botmagtokyo',
'botmusleafl',
'botnot',
'botrevlancaster',
'botsci',
'botstudtaipei',
'bottidsskr',
'botzhurnmoscowleningrad',
'bouteloua',
'bradea',
'bradleya',
'britferngaz',
'brittonia',
'brunonia',
'bullbimenssoclinnlyon',
'bullbotresharbin',
'bullbotsurvindia',
'bullbritmusnathistbot',
'bulletinmiscellaneousinformationkewadditionalseriesnewgeneraspeciescyperaceae',
'bulletinmiscellaneousinformationroyalgardenskew',
'bulletinsoci?t?botaniquefrance',
'bullherbboissier',
'bulljardbotbuitenzorg',
'bulljardbotnatlbelg',
'bulljardbotétatbruxelles',
'bullmenssoclinnlyon',
'bullmenssoclinnparis',
'bullmiscinformkew',
'bullmiscinformkewadditser',
'bullmushistnatparis',
'bullmusnationhistnatparis',
'bullmusnatlhistnat',
'bullmusnatlhistnatbadansonia',
'bullnathistmuslondonbot',
'bullnatlmusnatscitokyob',
'bullnewyorkbotgard',
'bullsocbotfrance',
'bullsocbotfrancelettbot',
'bullsoclinnparis',
'bullsocneuchâteloisescinat',
'bullsocroybotbelgique',
'bulltorreybotclub',
'bunrui',
'butinstcatalanahistnat',
'cactsuccjlosangeles',
'cactsucmex',
'caldasia',
'canadjbot',
'candollea',
'carnifloraaustralis',
'carnivplnewslett',
'castanea',
'ceiba',
'cienciamexico',
'cladistics',
'collectaneabotanica',
'collectbotbarcelona',
'contrbiollabkyotouniv',
'contrgrayherb',
'contribherbaustral',
'contribqueenslherb',
'contributionsfromherbariumaustraliense',
'contributionsfromqueenslandherbarium',
'contrunivmichiganherb',
'contrusnatlherb',
'curtissbotanicalmagazine',
'curtissbotanicalmagazineappendixcompaniontobotanicalmagazine',
'curtissbotanicalmagazinenewseries',
'curtissbotanicalmagazinens',
'curtissbotmag',
'danskbotark',
'darwiniana',
'edinburghjbot',
'edinburghjournalbotany',
'eurjtaxon',
'feddesrepert',
'femsyeastresearch',
'ferngaz',
'ferngazuk',
'fieldianabot',
'flcongobelgeruandaurundi',
'flmalesserspermat',
'flneotropmonogr',
'floramontiber',
'foliageobotphytotax',
'foliamalaysiana',
'fontqueria',
'forumgeobot',
'fritschiana',
'fungaldiversity',
'gardbullsingapore',
'gardensbulletinsingapore',
'gardensbulletinsingaporemaywlchewflaustralia',
'gartenflora',
'gayana',
'gayanabot',
'gayanabotánica',
'genetica',
'genschefflerasabah',
'globalfl',
'grana',
'greatbasinnaturalist',
'guihaia',
'harvardpapbot',
'harvardpapersbotany',
'haseltonia',
'hoehnea',
'ibugana',
'iheringiabot',
'intjplsci',
'jadelaidebotgard',
'jagrictropbotappl',
'jarnoldarbor',
'jassocstraits',
'jbamboores',
'jbiogeogr',
'jbombaynathistsoc',
'jbotresinsttexas',
'jbotsocbotfrance',
'jeafrnathist',
'jgeobot',
'jgeobothokuriku',
'jintconiferpreservsoc',
'jjapbot',
'jlinnsocbot',
'jnanjingforestunivnatscied',
'journagrictropbotappliq',
'journaladelaidebotanicgardens',
'journallinneansocietybotany',
'journalroyalsocietywesternaustralia',
'journalwashingtonacademysciences',
'journjapbot',
'jproclinnsocbot',
'jroysocwesternaustralia',
'jsafricanbot',
'jstraitsbranchroyasiatsoc',
'jsystevol',
'jthreattaxa',
'jtropsubtropbot',
'jwashacadsci',
'jwuhanbotres',
'kalikasan',
'kalmia',
'kanunnah',
'kewbull',
'kewbulletin',
'kirkia',
'komarovia',
'koreanjpltaxon',
'lankesteriana',
'lichenologist',
'lindleyana',
'lundellia',
'madroño',
'malayannatj',
'mededbotmusherbrijksunivutrecht',
'memamacadartssc',
'memameracad',
'memameracadarts',
'memameracadartsser',
'memjuntainvestultramarser',
'memmushistnatparisserbot',
'memnamacadartssc',
'memnewyorkbotgard',
'memoirsamericanacademyartssciences',
'memoirsamericanacademyartssciencesser',
'memoirsamericanacademysciences',
'memoirstorreybotanicalclub',
'memtorreybotclub',
'micronesica',
'mittbotstaatssammlmünchen',
'molecphylogenevol',
'monogrsystbotmissouribotgard',
'moscosoa',
'muelleria',
'métecolsist',
'nathistbullsiamsoc',
'nelumbo',
'neodiversity',
'newjbot',
'newzealandjbot',
'newzealandjournalbotany',
'nordicjbot',
'nordicjournalbotany',
'norwegjbot',
'notesroybotgardedinburgh',
'notizblbotgartberlindahlem',
'notizblköniglbotgartberlin',
'notulsystparis',
'nouvarchmushistnat',
'novon',
'novostisistvysshrast',
'nuytsia',
'occaspapcalifacadsci',
'oesterrbotwochenbl',
'oesterrbotz',
'operabot',
'organismsdiversityevol',
'orquideologia',
'pacificsci',
'parazitologiya',
'philippjsci',
'philippjscic',
'philippscientist',
'philtransroysoclondserb',
'phytokeys',
'phytologia',
'phytoneuron',
'phytonhorn',
'phytotaxa',
'plants[basel]',
'plbiosystems',
'pldiversevol',
'pldiversityresources',
'plecolevol',
'plosone',
'plosonee[oct][epublished]',
'plscij',
'plsystevol',
'polishbotj',
'procacadnatsciphiladelphia',
'procameracadarts',
'procamerphilossoc',
'procbiolsocwashington',
'proccalifacadsci',
'proceedingslinneansocietynewsouthwales',
'proclinnsocnewsouthwales',
'procroysocedinb',
'procroysocqueensland',
'publfieldcolumbianmusbotser',
'publfieldcolumbmusbotser',
'publfieldmusnathistbotser',
'pyrexjbiodiversconservation',
'recaucklandinstmus',
'recaucklinstmus',
'recueiltravbotnéerl',
'reinwardtia',
'repertoriumnovarumspecierumregnivegetabilis',
'repertspecnovregniveg',
'repertspecnovregnivegbeih',
'revbotapplagrictrop',
'revfacagronmaracay',
'revintbotapplagrictrop',
'revistaacadcolombciexact',
'revistabrasilbot',
'revistafacagronmaracay',
'revistaguatemal',
'revistaguatemalensis',
'revistajardbotnacunivhabana',
'revistamexbiodivers',
'revistamusplata',
'revistamusplataseccbot',
'revistaperubiol',
'revistasocbolivbot',
'revjardbotnacionunivhabana',
'rheedea',
'rhodora',
'richardiana',
'richardianans',
'rodriguésia',
'safricanjbot',
'sarawakmusj',
'sarawakmusjourn',
'schlechtendalia',
'schütziana',
'selbyana',
'sendtnera',
'sida',
'sidabotmisc',
'smithsoniancontrbot',
'smithsoniancontributionstobotany',
'smithsonianmisccollect',
'southwnaturalist',
'stapfia',
'svenskbottidskr',
'systbot',
'systbotmonogr',
'systematicbotany',
'systgeogrpl',
'taiwania',
'tapchísinhhọc',
'taprobanica',
'taxon',
'taxonomania',
'telopea',
'thaiforestbullbot',
'transactionsproceedingsroyalsocietysouthaustralia',
'transbotsocedinburgh',
'translinnsoclondon',
'translinnsoclondonbot',
'transprocbotsocedin',
'transprocbotsocedinb',
'transprocbotsocedinburgh',
'transprocroysocsaustral',
'transprocroysocsouthaustralia',
'transroysocsouthafrica',
'transsafricanphilossoc',
'transsandiegosocnathist',
'turczaninowia',
'turkishjbot',
'ukrayinskbotzhurn',
'utafiti',
'verhandlungenkaiserlichk?niglichenzoologischbotanischengesellschaftwien',
'verhandlungenzoologischbotanischengesellschaftwien',
'verhbotvereinsprovbrandenburg',
'verhkkzoolbotgeswien',
'verhzoolbotges',
'verhzoolbotgeswien',
'verhzoolbotgesösterr',
'verhzoolbotgesösterreich',
'victoriannaturalist',
'vierteljahrsschrnaturfgeszürich',
'watsonia',
'webbia',
'weberbauerella',
'wentia',
'willdenowia',
'wrightia',
'wulfenia',
'yearbookheathersoc',
'znaturfc',
'菌物学报',
];
  
  
  if (doc['message-format']) {
    if (doc['message-format'] == 'application/vnd.crossref-api-message+json') {

	  var csl = doc.message;
  
		if (csl.reference) {
		  var n = Math.max(10, csl.reference.length);
		  for (var i = 0; i < n; i++) {
			if (csl.reference[i]['journal-title']) {
			  
			    var text = csl.reference[i]['journal-title'];
			  	var key = finger_print(text);
			  	
			  	if (key.length > 5) {
	
	          //emit(key, text);
	          
	          if (x.indexOf(key) === -1) {
	            //emit(key, text);
	          } else {
	            // found an exact match
	            emit(key, text);
	          }
	
        	
			  	}
			 
			}
		  }
		
	  }
	}	
  }
}


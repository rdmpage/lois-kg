{
  "_id": "_design/references",
  "_rev": "11-c877bc0e08b0803f84c3656792030e87",
  "views": {
    "unstructured": {
      "map": "\n//----------------------------------------------------------------------------------------\nfunction (doc) {\n \n  if (doc['message-format']) {\n    if (doc['message-format'] == 'application/vnd.crossref-api-message+json') {\n\n\t  var csl = doc.message;\n  \n\t\tif (csl.reference) {\n\t\t  for (var i in csl.reference)\n\t\t\t  if (csl.reference[i].unstructured) {\n\t        emit(doc._id, csl.reference[i].unstructured);\n\t\t    }\n\t\t}\n\t\t}\n  }\n}\n\n"
    },
    "csl": {
      "map": "//----------------------------------------------------------------------------------------\n// START COUCHDB VIEW\n//----------------------------------------------------------------------------------------\n\n/*\n      {\n        \"key\": \"10.1111/njb.01689-BIB0016|cit-0016\",\n        \"doi-asserted-by\": \"crossref\",\n        \"first-page\": \"3\",\n        \"DOI\": \"10.1007/s12225-009-9098-2\",\n        \"article-title\": \"New and little-known species of Strobilanthes (Acanthaceae) from India and southeast Asia\",\n        \"volume\": \"64\",\n        \"author\": \"Wood\",\n        \"year\": \"2009\",\n        \"journal-title\": \"Kew Bull\"\n      }\n*/\n\n\n//----------------------------------------------------------------------------------------\nfunction to_csl(doc) {\n    var csl = {};\n    \n \t\n\t// id\n\tif (doc.key) {\n\t\tvar key = doc.key;\n\t\t\n\t\tkey = key.replace(/\\t/g, '');\n\t\tkey = key.replace(/\\n/g, '');\n\n\t\t// replace characters not allowed\n\t\tkey = key.replace(/\\|/g, '-');\n\t\tkey = key.replace(/\\//g, '-');\n\t\tkey = key.replace(/\\./g, '-');\n\t\tkey = key.replace(/\\s/g, '-');\n\t\t\n\t\tcsl.id = key;\n\t}\n\t\n\t// type\n\tcsl.type = 'generic'; \t\n \n\t// DOI\n\tif (doc.DOI) {\n\t\tcsl.DOI = doc.DOI.toLowerCase();\n\t}\n \t\n\t\n\t// title\n\tif (doc['article-title']) {\n\t\tcsl.title = doc['article-title'];\n\t}\n\t\n\t// journal-title\n\tif (doc['journal-title']) {\n\t\tcsl['container-title'] = doc['journal-title'];\n\t\t\n\t\tcsl['container-title'] = csl['container-title'].replace(/^-\\s*/, '');\n\t\t\n\t\tcsl.type = 'article-journal';\n\t}\n\t\n\t// journal-title\n\tif (doc.ISSN) {\n\t\tcsl.ISSN[doc.ISSN];\n\t}\n\t\n\t// volume\n\tif (doc.volume) {\n\t\tcsl.volume = doc.volume;\n\t}\n\t\n\t// page\n\tif (doc['first-page']) {\n\t\tcsl.page = doc['first-page'];\n\t}\n \t\n \t// date\n\tif (doc.year) {\n\t\tcsl.issued = {};\n\t\tcsl.issued['date-parts'] = [];\n\t\tcsl.issued['date-parts'].push([parseInt(doc.year)]);\n\t}\n\t\n\tif (doc.author) {\n\t\tcsl.author = [ { literal: doc.author}];\n\t}\n\n\t/*\n\t// Book\n\tif (doc.publisher) {\n\t\tcsl.publisher = doc.publisher.name;\n\t\t\n\t\tif (doc.publisher.address) {\n\t\t\tcsl['publisher-place'] = doc.publisher.address;\n\t\t}\n\t\t\n\t\tif (doc.pages) {\n\t\t\tcsl.page = doc.pages.replace(/--/, '-');\t\n\t\t}\n\t}\n\n\t// Chapter\n\tif (doc.book) {\n\t\tif (doc.book.title) {\n\t\t\tcsl['container-title'] = doc.book.title;\n\t\t}\n\t\tif (doc.pages) {\n\t\t\tcsl.page = doc.pages.replace(/--/, '-');\t\n\t\t}\n\t\t\n\t\tif (doc.book.publisher) {\n\t\t\tcsl.publisher = doc.book.publisher.name;\n\t\t\n\t\t\tif (doc.book.publisher.address) {\n\t\t\t\tcsl['publisher-place'] = doc.book.publisher.address;\n\t\t\t}\t\t\n\t\t}\n\t\t\n\t\tif (doc.book.editor) {\n\t\t\tcsl.editor = [];\n\t\t\n\t\t\tfor (var i in doc.author) {\n\t\t\t\tvar author = {};\n\t\t\t\n\t\t\t\t// hack while we work with old BioStor BibJSON\n\t\t\t\tif (doc.book.editor[i].forename) {\n\t\t\t\t\tauthor.given = doc.book.editor[i].forename;\n\t\t\t\t}\n\n\t\t\t\tif (doc.book.editor[i].firstname) {\n\t\t\t\t\tauthor.given = doc.book.editor[i].firstname;\n\t\t\t\t}\n\n\t\t\t\tif (doc.book.editor[i].lastname) {\n\t\t\t\t\tauthor.family = doc.book.editor[i].lastname;\n\t\t\t\t}\n\t\t\t\n\t\t\t\tif (!author.given && doc.book.editor[i].name) {\n\t\t\t\t\tauthor.literal = doc.book.editor[i].name;\n\t\t\t\t}\n\t\t\t\n\t\t\t\tcsl.editor.push(author);\n\t\t\t\n\t\t\t}\n\t\t}\t\t\n\t}\n\t\n\t// container\n    if (doc.journal) {\n\t\tif (doc.journal.name) {\n\t\t\tcsl['container-title'] = doc.journal.name;\n\t\t}\n\n\t\tif (doc.journal.series) {\n\t\t\tcsl['collection-title'] = doc.journal.series;\n\t\t}\n\t\n\t\t// volume\n\t\tif (doc.journal.volume) {\n\t\t\tcsl.volume = doc.journal.volume;\t\t\n\t\t} \n\n\t\t// issue\n\t\tif (doc.journal.issue) {\n\t\t\tcsl.issue = doc.journal.issue;\t\t\n\t\t} \n\t\n\t\t// page\n\t\tif (doc.journal.pages) {\n\t\t\tcsl.page = doc.journal.pages.replace(/--/, '-');\t\t\n\t\t} \n\t\n\t\t// issn, oclc\n\t\tif (doc.journal.identifier)\t{\n\t\t\tfor (var i in doc.journal.identifier) {\n\t\t\t\tswitch (doc.journal.identifier[i].type) {\n\t\t\t\t\tcase 'issn':\n\t\t\t\t\t\tif (!csl.ISSN) {\n\t\t\t\t\t\t\tcsl.ISSN = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcsl.ISSN.push(doc.journal.identifier[i].id);\n\t\t\t\t\t\tbreak;\n\t\t\t\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\t\n\t*/\n\n\n\t\n\treturn csl;\n}\n\n//----------------------------------------------------------------------------------------\nfunction message(doc) {\n  if (doc.message) {\n\n\t//var references = [];\n\t\n\tif (doc.message.reference) {\n\t\tfor (var i in doc.message.reference) {\n\t\t\tvar csl = to_csl(doc.message.reference[i]);\n\t\t\t\n\t\t\t// filter\n\t\t\tif (csl.title) {\n\t\t\t  emit(csl.id, csl);\n\t\t\t}\n\t\t}\n\t\n\t}\n\t\n\t//$('#jsonld').html(JSON.stringify(references, null, 2));\n \t  \n  }\n}\n\nfunction (doc) {\n  if (doc['message-format']) {\n    if (doc['message-format'] == 'application/vnd.crossref-api-message+json') {\n      message(doc);\n    }\n  }\n}\n\n// END COUCHDB VIEW"
    },
    "journal-title": {
      "map": "\n//----------------------------------------------------------------------------------------\nfunction finger_print(s) {\n\ts = s.toLowerCase();\n\n\t// stop words\n\t// en\n\ts = s.replace(/\\bfor\\b/g, '');\n\ts = s.replace(/\\band\\b/g, '')\n\ts = s.replace(/\\bof\\b/g, '');\n\ts = s.replace(/\\bthe\\b/g, '');\n\ts = s.replace(/\\bin\\b/g, '');\n\n\t// fr\n\ts = s.replace(/\\bde\\b/g, '');\n\ts = s.replace(/\\bdu\\b/g, '');\n\ts = s.replace(/\\bla\\b/g, '');\n\ts = s.replace(/\\bet\\b/g, '');\n\t\n\ts = s.replace(/\\bd['|’]/g, '');\n\ts = s.replace(/\\bl['|’]/g, '');\n\n\t// de\n\ts = s.replace(/\\bdas\\b/g, '');\n\ts = s.replace(/\\bder\\b/g, '');\n\ts = s.replace(/\\bfur\\b/g, '');\n\ts = s.replace(/\\bfür\\b/g, '');\n\t\n\t// es\n\ts = s.replace(/\\bdel\\b/g, '');\n\ts = s.replace(/\\ben\\b/g, '');\n\ts = s.replace(/\\by\\b/g, '');\n\t\n\t// accents\n\ts = s.replace(/á/g, 'a');\n\ts = s.replace(/ç/g, 'c');\n\ts = s.replace(/é/g, 'e');\n\ts = s.replace(/í/g, 'i');\n\ts = s.replace(/ó/g, 'o');\n\ts = s.replace(/ö/g, 'o');\n\ts = s.replace(/ü/g, 'u');\n\t\n\n\n\t// numbers\n\ts = s.replace(/\\d+/g, '');\n\t\n\t// series\n\ts = s.replace(/\\bser\\.?\\b/i, '');\n\n\n\t// punctuation\n\ts = s.replace(/[–|-|\\.|,|\\'|\\(|\\)|\"|:|-|&|-|’|\\[|\\]]+/g, '');\n\n\ts = s.replace(/\\s\\s*/g, ' ');\n\t\n\t// trim\n\ts = s.replace(/\\s+$/g, '');\n\ts = s.replace(/^\\s+/g, '');\n\n\treturn s;\n}\n\n\n//----------------------------------------------------------------------------------------\nfunction (doc) {\n\n  if (doc['message-format']) {\n    if (doc['message-format'] == 'application/vnd.crossref-api-message+json') {\n\n\t  var csl = doc.message;\n  \n\t\tif (csl.reference) {\n\t\t  var n = Math.max(10, csl.reference.length);\n\t\t  for (var i = 0; i < n; i++) {\n\t\t\tif (csl.reference[i]['journal-title']) {\n\t\t\t  \n\t\t\t    var text = csl.reference[i]['journal-title'];\n\t\t\t  \tvar key = finger_print(text);\n\t\t\t  \t\n\t\t\t  \tif (key != '') {\n\t\t\t\t    var parts = key.split(' ');\n    \t\t\t\temit(parts,1);\t\n\t\t\t  \t}\n\t\t\t}\n\t\t  }\n\t\t\n\t  }\n\t}\t\n  }\n}\n\n",
      "reduce": "_sum"
    }
  },
  "language": "javascript"
}
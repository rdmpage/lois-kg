{
  "_id": "_design/ld",
  "_rev": "10-e1b8c6d7a46d9f607c198e9d649a674e",
  "lists": {
    "triples": "function(head,req) { var row; start({ 'headers': { 'Content-Type': 'text/plain' } }); while(row = getRow()) { send(row.value); } }"
  },
  "views": {
    "nt-flat": {
      "map": "/*\n\nShared code\n\n\n*/\n//----------------------------------------------------------------------------------------\n// http://stackoverflow.com/a/25715455\nfunction isObject(item) {\n  return (typeof item === \"object\" && !Array.isArray(item) && item !== null);\n}\n\n//----------------------------------------------------------------------------------------\n// http://stackoverflow.com/a/21445415\nfunction uniques(arr) {\n  var a = [];\n  for (var i = 0, l = arr.length; i < l; i++)\n    if (a.indexOf(arr[i]) === -1 && arr[i] !== '')\n      a.push(arr[i]);\n  return a;\n}\n\n\n//----------------------------------------------------------------------------------------\n// Store a triple with optional language code\nfunction triple(subject, predicate, object, language) {\n  var triple = [];\n  triple[0] = subject;\n  triple[1] = predicate;\n  triple[2] = object;\n\n  if (typeof language === 'undefined') {} else {\n    triple[3] = language;\n  }\n\n  return triple;\n}\n\n//----------------------------------------------------------------------------------------\n// Enclose triple in suitable wrapping for HTML display or triplet output\nfunction wrap(s, html) {\n  if (s) {\n\t// URL as a literal (e.g., schema:sameAs)\n   if (s.match(/^\"(http|urn|_:)/)) {\n   \t\treturn s;\n   } else {\t\n\n\t  if (s.match(/^(http|urn|_:)/)) {\n\t\ts = s.replace(/\\\\_/g, '_');\n\n\t\t// handle < > in URIs such as SICI-based DOIs\n\t\ts = s.replace(/</g, '%3C');\n\t\ts = s.replace(/>/g, '%3E');\n  \n\t\tif (html) {\n\t\t  s = '&lt;' + s + '&gt;';\n\t\t} else {\n\t\t  s = '<' + s + '>';\n\t\t}\n\t  } else {\n\t\ts = '\"' + s.replace(/\"/g, '\\\\\"') + '\"';\n\t  }}\n\t}\n  return s;\n\n}\n\n//----------------------------------------------------------------------------------------\n// https://css-tricks.com/snippets/javascript/htmlentities-for-javascript/\nfunction htmlEntities(str) {\n  return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n//----------------------------------------------------------------------------------------\nfunction detect_language(s) {\n  var language = null;\n  var matched = 0;\n  var parts = [];\n\n  var regexp = [];\n\n  // https://gist.github.com/ryanmcgrath/982242\n  regexp['ja'] = /[\\u3000-\\u303F]|[\\u3040-\\u309F]|[\\u30A0-\\u30FF]|[\\uFF00-\\uFFEF]|[\\u4E00-\\u9FAF]|[\\u2605-\\u2606]|[\\u2190-\\u2195]|\\u203B/g;\n  // http://hjzhao.blogspot.co.uk/2015/09/javascript-detect-chinese-character.html\n  regexp['zh'] = /[\\u4E00-\\uFA29]/g;\n  // http://stackoverflow.com/questions/32709687/js-check-if-string-contains-only-cyrillic-symbols-and-spaces\n  regexp['ru'] = /[\\u0400-\\u04FF]/g;\n\n  for (var i in regexp) {\n    parts = s.match(regexp[i]);\n\n    if (parts != null) {\n      if (parts.length > matched) {\n        language = i;\n        matched = parts.length;\n      }\n    }\n  }\n\n  // require a minimum matching\n  if (matched < 2) {\n    language = null;\n  }\n\n  return language;\n\n}\n\n//----------------------------------------------------------------------------------------\nfunction output(doc, triples) {\n  // CouchDB\n  for (var i in triples) {\n    var s = 0;\n    var p = 1;\n    var o = 2;\n\n    var lang = 3;\n\n    var nquads = wrap(triples[i][s], false) +\n      ' ' + wrap(triples[i][p], false) +\n      ' ' + wrap(triples[i][o], false);\n    if (triples[i][lang]) {\n      nquads += '@' + triples[i][lang];\n    }\n\n    nquads += ' .' + \"\\n\";\n\n    // use cluster_id as the key so triples from different versions are linked together\n    emit(doc._id, nquads);\n    //console.log(nquads);\n  }\n}\n\n//----------------------------------------------------------------------------------------\n// START COUCHDB VIEW\n\n//----------------------------------------------------------------------------------------\n// Return true if value is not empty, tests for strange stuff such as \"[Not Stated]\"\nfunction not_empty(value) {\n\tvar empty = true;\n\t\n\tif (!value) {\n\t\treturn false;\n\t}\n\n\tif (value == null) {\n\t\treturn false;\n\t}\n\n\tif (value.match(/\\[Not Stated\\]/i)) {\n\t\treturn false;\n\t}\n\t\n\treturn empty;\n\n\n}\n\n//----------------------------------------------------------------------------------------\n// Get a list of specimen codes and other potential specimen identifiers\nfunction specimen_codes(doc) {\n  var codes = [];\n\n  // By default we simply output institutionCode and catalogNumber,\n  // but for some we need special processing. Setting output_default to false\n  // means that the simple institutionCode + catalogNumber\n  // doesn't apply.\n  var output_default = true;\n\n  // Here we do any special processing do create codes seen in the wild\n  switch (doc.message.datasetKey) {\n\n    // AMNH\n    // Birds\n    case '96c93a1e-f762-11e1-a439-00145eb45e9a':\n      var catalogNumber = doc.message.catalogNumber;\n      catalogNumber = catalogNumber.replace(/DOT-/i, '');\n      catalogNumber = catalogNumber.replace(/SKIN-/i, '');\n      codes.push(doc.message.institutionCode + ' ' + catalogNumber);\n      break;\n\n      // AM\n    case 'dce8feb0-6c89-11de-8225-b8a03c50a862':\n      var catalogNumber = doc.message.catalogNumber;\n      catalogNumber = catalogNumber.replace(/\\\\./, '');\n      codes.push(doc.message.institutionCode + ' ' + catalogNumber);\n      if (catalogNumber.match(/^R/)) {\n        codes.push(doc.message.institutionCode + catalogNumber);\n      }\n      codes.push('Australian Museum ' + catalogNumber);\n      output_default = false;\n      break;\n\n      // ANWC\n    case '0debafd0-6c8a-11de-8225-b8a03c50a862':\n      if (doc.message.catalogNumber.match(/^[A-Z]/)) {\n        codes.push(doc.message.institutionCode + ':' + doc.message.catalogNumber.replace(/^[A-Z][0]*/, ''));\n      }\n      break;\n\n      // CASIZ\n    case '44bcde48-ac71-46f2-bf73-24fc3c008b6c':\n      var catalogNumber = doc.message.catalogNumber.replace(/\\\\.0/, '');\n      codes.push(doc.message.institutionCode + ' ' + catalogNumber);\n      // CAS:CASIZ 175448 \n      codes.push(doc.message.institutionCode + ':CASIZ ' + catalogNumber);\n      output_default = false;\n      break;\n\n      // CAS herps\n    case 'cece4fc2-1fec-4bb5-a335-7252548e3f0b':\n      codes.push(doc.message.institutionCode + doc.message.catalogNumber);\n      codes.push(doc.message.institutionCode + ':Herp:' + doc.message.catalogNumber);\n      break;\n      // CAS Ichs\n        \n    case '5d6c10bd-ea31-4363-8b79-58c96d859f5b':\n          codes.push(doc.message.institutionCode + doc.message.catalogNumber);    \n      codes.push(doc.message.institutionCode + ':Ich:' + doc.message.catalogNumber);    \n      break;\n\n      // CSIRO\n      // CSIRO Ichthyology provider for OZCAM\n    case '18c93d12-34fb-4d3f-903c-b77215a1dcc9':\n      if (doc.message.catalogNumber.match(/^H/)) {\n        // BOLD cites them like this\n        codes.push(doc.message.institutionCode + ' H ' + doc.message.catalogNumber.replace(/^H/, ''));\n      }\n      break;\n\n      // FMNH\n    case 'e48d6c49-34a3-4df6-8206-121c061f190d':\n        codes.push(doc.message.institutionCode + ':HERP:' + doc.message.catalogNumber);\n      break;\n\n      // Kew\n    case 'cd6e21c8-9e8a-493a-8a76-fbf7862069e5':\n        codes.push(doc.message.catalogNumber);\n      output_default = false;\n      break;\n\n      // MHNG\n    case '5a659248-1f70-11e3-b2c5-00145eb45e9a':\n      if (doc.message.catalogNumber.match(/^MHNG-MAM-/)) {\n        var catalogNumber = doc.message.catalogNumber;\n        catalogNumber = catalogNumber.replace(/MHNG-MAM-/, '');  \n        codes.push(doc.message.institutionCode + ' ' + catalogNumber);\n\n        // for BOLD\n        catalogNumber = catalogNumber.replace(/\\\\./, '');  \n        codes.push(doc.message.institutionCode + '-' + catalogNumber);\n        output_default = false;\n      }\n      break;\n\n      // MNHN\n    case '1b2af425-9f6f-4b28-a008-af9757317c4c':\n      if (doc.message.catalogNumber.match(/^ENSIF/)) {\n        var catalogNumber = doc.message.catalogNumber;\n        catalogNumber = catalogNumber.replace(/ENSIF/, '');  \n        codes.push(doc.message.institutionCode + ':ENSIF ' + catalogNumber);\n      }\n      break;\n      // MHNH birds\n    case 'ba0c03ab-fa61-4a3c-8db7-35c8c3454168':\n      if (doc.message.catalogNumber.match(/^MO/)) {\n        var catalogNumber = doc.message.catalogNumber;\n        catalogNumber = catalogNumber.replace(/MO-/, '');  \n        codes.push(doc.message.institutionCode + ' ' + catalogNumber);\n      }\n      break;\n\n      // MCZ\n    case '4bfac3ea-8763-4f4b-a71a-76a6f5f243d3':\n      if (doc.message.catalogNumber.match(/^[R]-/)) {\n        codes.push(doc.message.institutionCode + ' ' + doc.message.catalogNumber.replace(/^[R]-/, ''));\n      }\n      break;\n\n      // MVZ\n    case '09c4287e-e6d5-4552-a07f-bff8a00833d8':\n         codes.push(doc.message.institutionCode + ':Herp:' + doc.message.catalogNumber);   \n      break;\n\n      // NMV D\n    case '39905320-6c8a-11de-8226-b8a03c50a862':\n      codes.push(doc.message.institutionCode + doc.message.catalogNumber.replace(/ /, ''));\n      codes.push('NMV<AUS>:' + doc.message.institutionCode + doc.message.catalogNumber.replace(/ /, ''));\n      break;\n\n      // OMNH Osaka Museum of Natural History fish\n    case '849f0a76-f762-11e1-a439-00145eb45e9a':\n      if (doc.message.collectionCode == 'P') {\n        codes.push(doc.message.institutionCode + '-' + doc.message.collectionCode + ' ' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n        output_default = false;\n      }\n      break;\n\n      // OSUC\n      // C.A. Triplehorn Insect Collection, Ohio State University, Columbus, OH (OSUC)\n    case '84ab7b76-f762-11e1-a439-00145eb45e9a':\n      codes.push(doc.message.catalogNumber);\n      output_default = false;\n      break;\n      \n\n      // TTU\n      // mammals\n    case '854f70cc-55e3-4af2-9417-0f47d6c7902d':\n      // output field numbers as tissue numbers\n      if (doc.message.fieldNumber) {\n        codes.push('TK' + doc.message.fieldNumber);\n        codes.push('TK ' + doc.message.fieldNumber);\n      }\n      break;\n\n      // UAM\n      // mammals\n    case '377be098-626f-4cc2-b4b5-35700050669a':\n      codes.push(doc.message.institutionCode + ':Mamm:' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n      break;\n\n      // UF (FLMNH)\n      // Ichthyology\n    case 'eccf4b09-f0c8-462d-a48c-41a7ce36815a':\n      codes.push('FLMNH ' + doc.message.catalogNumber);\n      codes.push('UF' + doc.message.catalogNumber);\n      break;\n      // Inverts (e.g., moolluscs)\n    case '85b1cfb6-f762-11e1-a439-00145eb45e9a':\n      codes.push('UF ' + doc.message.catalogNumber.replace(/\\\\-\\\\w+$/, ''));\n      break;\n\n      // USNM\n    case '5df38344-b821-49c2-8174-cf0f29f4df0d':\n      codes.push(doc.message.institutionCode + ' ' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n\n      switch (doc.message.collectionCode) {\n        case 'Amphibians & Reptiles':\n          codes.push(doc.message.institutionCode + ':Herp:' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n          break;\n        case 'Birds':\n          codes.push(doc.message.institutionCode + ':Birds:' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n          break;\n        case 'Fishes':\n          codes.push(doc.message.institutionCode + ':Fish:' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n          break;\n        case 'Mammals':\n          codes.push(doc.message.institutionCode + ':MAMM:' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n          break;\n        default:\n          break;\n      }\n      output_default = true;\n      break;\n\n      // UTA\n      // Herpetology\n    case '8d88898d-a2c4-4616-a1fe-431b9c06b671':\n      switch (doc.message.collectionCode) {\n        case 'UTA-A':\n          codes.push(doc.message.institutionCode + ' A' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n          codes.push(doc.message.institutionCode + ' A-' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n          break;\n        case 'UTA-R':\n          codes.push(doc.message.institutionCode + ' R' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n          codes.push(doc.message.institutionCode + ' R-' + doc.message.catalogNumber.replace(/\\\\.\\\\d+/, ''));\n          break;\n        default:\n          break;\n      }\n      break;\n\n      // UWBM \n      // birds\n    case '830fd460-f762-11e1-a439-00145eb45e9a':\n      break;\n\n      // UZA\n    case '96c25708-f762-11e1-a439-00145eb45e9a':\n      codes.push(doc.message.catalogNumber);\n      output_default = false;\n      break;\n\n      // WAM\n    case '7c93d290-6c8b-11de-8226-b8a03c50a862':\n      codes.push(doc.message.institutionCode + doc.message.catalogNumber);\n      codes.push(doc.message.institutionCode + ' ' + doc.message.catalogNumber.replace(/^R/, ''));\n\n      if (doc.message.collectionCode == \"REPT\") {\n        // Number-only codes need R prefix\n        if (doc.message.catalogNumber.match(/^\\\\d+/)) {\n          codes.push(doc.message.institutionCode + 'R' + doc.message.catalogNumber);\n          codes.push(doc.message.institutionCode + ' R' + doc.message.catalogNumber);\n        }\n      }\n      break;\n\n      // YPM Inverts\n    case '854e35e6-f762-11e1-a439-00145eb45e9a':\n      // YPM entomology\n    case '96404cc2-f762-11e1-a439-00145eb45e9a':\n      // YPM fish\n    case '96419bea-f762-11e1-a439-00145eb45e9a':\n      // YPM Herps\n    case '861d3d64-f762-11e1-a439-00145eb45e9a':\n      // YPM birds\n    case '854cf79e-f762-11e1-a439-00145eb45e9a':\n      // YPM mammals\n    case '854f602e-f762-11e1-a439-00145eb45e9a':\n      var parts = doc.message.catalogNumber.match(/(YPM)\\\\s+([A-Z]+)\\\\s+(0+)?(\\\\d+)/);\n      if (parts) {\n        var collection = parts[2];\n        var catalogNumber = parts[4];\n\n        // YPM \\\\d+\n        codes.push(doc.message.institutionCode + ' ' + catalogNumber);\n        // YPM as is\n        codes.push(doc.message.catalogNumber);\n        // DwC triple\n        collection = collection.substr(0, Math.min(3, collection.length));\n        codes.push(doc.message.institutionCode + ':' + collection + ':' + catalogNumber);\n      }\n      output_default = false;\n      break;\n      \n      // ZMA\n      // ZMA fish types\n    case '903b7df0-6166-11de-84bf-b8a03c50a862':\n      var catalogNumber  = doc.message.catalogNumber;\n      catalogNumber = catalogNumber.replace(/Pisces_/, '');\n      catalogNumber = catalogNumber.replace(/,/, '.');\n      codes.push(doc.message.institutionCode + ' ' + catalogNumber);\n      output_default = true;\n      break;\n\n      // ZMUC\n    case 'cb643105-2e6b-403d-a23b-2c8128d1f97c':\n      codes.push(doc.message.catalogNumber.replace(/-/, ' '));\n      output_default = false;\n      break;\n\n      // ZMUC birds\n    case 'af3bce08-0599-45a6-9bfc-08188bcd868e':\n      var catalogNumber = doc.message.catalogNumber.replace(/AVES-0?/, '');\n      codes.push(doc.message.institutionCode + ' ' + catalogNumber);\n      // see doi:10.1007/s10336-006-0082-4\n      if (catalogNumber.length == 5) {\n        codes.push(doc.message.institutionCode + ' ' + catalogNumber.substr(0, 2) + '.' + catalogNumber.substr(2, 3));\n      }\n      output_default = false;\n      break;\n\n      // Zoologische Staatssammlung Muenchen\n      // International Barcode of Life (iBOL) - Barcode of Life Project Specimen Data\n    case 'f29ab192-5964-40ae-a397-fa48ffdf0661':\n      codes.push(doc.message.catalogNumber);\n      output_default = false;\n      break;\n\n    default:\n      output_default = true; // for now while we debug, make true when all done\n      break;\n  }\n\n\n  // add any other useful records\n  if (doc.message.otherCatalogNumbers) {\n    codes.push(doc.message.otherCatalogNumbers);\n  }\n\n  if (doc.message.recordNumber) {\n    codes.push(doc.message.recordNumber);\n    \n    if (doc.message.recordedBy) {\n    \tcodes.push(doc.message.recordedBy + ' ' + doc.message.recordNumber);\n    }\n  }\n\n\t\n  if (output_default) {\n    if (doc.message.institutionCode && doc.message.catalogNumber) {\n      codes.push(doc.message.institutionCode + ' ' + doc.message.catalogNumber);\n    }\n\n    // For when we have complete specimen code as catalogue number\n    if (doc.message.catalogNumber) {\n      codes.push(doc.message.catalogNumber);\n    }\n  }\n\n  // Make unique\n  var unique = [];\n  for (var i = 0; i < codes.length; i++) {\n    if (unique.indexOf(codes[i]) == -1) {\n      unique.push(codes[i]);\n    }\n  }\n\n  return unique;\n}\n\n//----------------------------------------------------------------------------------------\nfunction message(doc) {\n\n    var triples = [];\n    \n    \n\tvar gbifID = 0;\n\tif (doc.message.gbifID) {\n\t\tgbifID = doc.message.gbifID;\n\t}\n\tif (doc.message.key) {\n\t\tgbifID = doc.message.key;\n\t}\n\n\tvar subject_id = 'https://www.gbif.org/occurrence/' + gbifID;\n\n/*\n\tvar name = [];\n\tif (doc.message.institutionCode) {\n\t\tname.push(doc.message.institutionCode);\n\t}\n\tif (doc.message.collectionCode) {\n\t\tname.push(doc.message.collectionCode);\n\t}\n\tif (doc.message.catalogNumber) {\n\t\tname.push(doc.message.catalogNumber);\n\t}\n\t// Cases where there is not a Darwin Core triple\n\tif (name.length == 0) {\n\t\tif (doc.message.occurrenceID) {\n\t  \t\tname.push(doc.message.occurrenceID);\n\t\t}\n\t}\n*/\n\n\t// make a nice title for display\n\tvar name = [];\n\t\n\tif (doc.message.typeStatus) {\n\t\tname.push(doc.message.typeStatus + ' of');\n\t}\n\n\tif (doc.message.scientificName) {\n\t\tname.push(doc.message.scientificName);\n\t}\n\t\n\tif (doc.message.family) {\n\t\tname.push('[family ' + doc.message.family.toUpperCase() + ']');\n\t}\n\n\tif (doc.message.institutionCode) {\n\t\tname.push('(' + doc.message.institutionCode + ')');\n\t}\n\t\t\n\n\t// schema.org\n\n\ttriples.push(triple(subject_id,\n\t\t'http://schema.org/name',\n\t\tString(name.join(' ')) ));\n\t\t\n\n\t  // post processing\n  /*\n\t  // alternative specimen codes\n\t  var codes = specimen_codes(doc);\n\t  for (var i in codes) {\n\t\ttriples.push(triple(subject_id,\n\t\t  'http://schema.org/alternateName',\n\t\t  String(codes[i])));\n\t  }    \n\t*/\t\n\t// GBIF taxonomy\t\n\tif (doc.message.acceptedTaxonKey) {\n\t\tvar taxon_id = 'https://www.gbif.org/species/' + doc.message.acceptedTaxonKey;\n\t\n\t\t// link to GBIF taxon\n\t\ttriples.push(triple(subject_id,\n\t\t\t'http://rs.tdwg.org/dwc/terms/taxonID',\n\t\t\ttaxon_id\n\t\t  ));\n\t\t  \n\t\t// Add identifier so we can link\n\t\tvar taxon_identifier = taxon_id + '#gbif';\n\t\t\n\t\ttriples.push(triple(taxon_id,\n\t\t\t'http://schema.org/identifier',\n\t\t\ttaxon_identifier\n\t\t  ));\n\t\t  \n\t\ttriples.push(triple(taxon_identifier,\n\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t'http://schema.org/PropertyValue'\n\t\t  ));\n\t\t  \n\n\t\ttriples.push(triple(taxon_identifier,\n\t\t\t'http://schema.org/propertyID',\n\t\t\t'\"https://www.wikidata.org/wiki/Property:P846\"'\n\t\t  ));\n\t\t  \n\t\ttriples.push(triple(taxon_identifier,\n\t\t\t'http://schema.org/name',\n\t\t\t'GBIF'\n\t\t  ));\n\n\t\ttriples.push(triple(taxon_identifier,\n\t\t\t'http://schema.org/value',\n\t\t\tdoc.message.acceptedTaxonKey.toString()\n\t\t  ));\n\t}\t\t\t\n\t\t\n\t// Dublin Core and Darwin Core from here\t\n/*\n\ttriples.push(triple(subject_id,\n\t\t'http://purl.org/dc/terms/title',\n\t\tString(name.join(' ')) ));\n*/\n\n\ttriples.push(triple(subject_id,\n\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t'http://rs.tdwg.org/dwc/terms/Occurrence'));\n\t\t\n  // fields\n  for (var i in doc.message) {\n    if (doc.message[i] != null) {\n      switch (i) {\n\t\t\n\t\t\t  // Occurrence (usually a specimen)\n\t\t\t  // Darwin Core occurrence---------------------------------------------------\n\t\t\tcase 'catalogNumber':\n\t\t\tcase 'collectionCode':\n\t\t\tcase 'collectionID':\n\t\t\tcase 'institutionCode':\n\t\t\tcase 'institutionID':\n\t\t\tcase 'recordedBy':\n\t\t\tcase 'individualCount':\n\t\t\tcase 'organismQuantity':\n\t\t\tcase 'sex':\n\t\t\tcase 'lifeStage':\n\t\t\tcase 'reproductiveCondition':\n\t\t\tcase 'behavior':\n\t\t\tcase 'establishmentMeans':\n\t\t\tcase 'occurrenceStatus':\n\t\t\tcase 'preparations':\n\t\t\tcase 'disposition':\n\t\t\t//case 'otherCatalogNumbers':\n\t\t\tcase 'recordNumber':\n\t\t\tcase 'occurrenceRemarks':\n\t\t\tcase 'occurrenceID':\n\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://rs.tdwg.org/dwc/terms/' + i,\n\t\t\t\tString(doc.message[i])));\n\t\t\t  break;\n\t\t\t  \n\t\t\t  // to do:may be URI or string, of concatenation of both types\n\t\t\t  // e.g. https://www.gbif.org/occurrence/1426114122\n\t\t\tcase 'otherCatalogNumbers':\t\t\t\t\n\t\t\t\tbreak;\n\t\t\t  \n\t\t\t  \n         // Darwin Core locality-----------------------------------------------------------\n        case 'continent':\n        case 'coordinateUncertaintyInM':\n        case 'coordinatePrecision':\n        case 'country':\n        case 'county':\n        case 'countryCode':\n        case 'decimalLatitude':\n        case 'decimalLongitude':\n        case 'depth':\n        case 'depthAccuracy':\n        case 'elevation':\n        case 'footprintWKT':\n        case 'footprintSRS':\n        case 'footprintSpatialFit':\n        case 'geodeticDatum':\n        case 'georeferencedBy':\n        case 'georeferencedDate':\n        case 'georeferenceSources':\n        case 'georeferenceProtocol':\n        case 'georeferenceVerification':\n        case 'georeferenceRemarks':\n        case 'higherGeography':\n        case 'higherGeographyID':\n        case 'island':\n        case 'islandGroup':\n        case 'locality':\n        case 'locationAccordingTo':\n        case 'locationID':\n        case 'locationRemarks':\n        case 'maximumElevationInMeters':\n        case 'minimumElevationInMeters':\n        case 'maximumDepthInMeters':\n        case 'minimumDepthInMeters':\n        case 'minimumDistanceAboveSurf':\n        case 'maximumDistanceAboveSurf':\n        case 'municipality':\n        case 'pointRadiusSpatialFit':\n        case 'stateProvince':\n        case 'verbatimCoordinates':\n        case 'verbatimLatitude':\n        case 'verbatimLongitude':\n        case 'verbatimCoordinateSystem':\n        case 'verbatimSRS':\n        case 'verbatimDepth':\n        case 'verbatimElevation':\n        case 'verbatimLocality':\n        case 'waterBody':\n          triples.push(triple(subject_id,\n            'http://rs.tdwg.org/dwc/terms/' + i,\n            String(doc.message[i])));\n          break;\t\t\t  \n\t\t  \n          // Darwin Core Event----------------------------------------------------------\n        case 'fieldNumber':\n        case 'eventDate':\n        case 'year':\n        case 'month':\n        case 'day':\n        case 'verbatimEventDate':\n        case 'fieldNotes':\n        case 'eventRemarks':\n        case 'eventID':\n           triples.push(triple(subject_id,\n            'http://rs.tdwg.org/dwc/terms/' + i,\n            String(doc.message[i])));\n          break;\t\n          \n          // media\n        case 'media':\n /*       \n<dwc:associatedMedia rdf:resource=\"http://imager.mnhn.fr/imager3/w400/media/1441382723320rSt5oKNmW0bmqfJn\" />\n</rdf:Description>\n<rdf:Description rdf:about=\"http://imager.mnhn.fr/imager3/w400/media/1441382723320rSt5oKNmW0bmqfJn\">\n    <rdfs:comment>Describing a thumbnail representation of the item.</rdfs:comment> \n    <rdf:type rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n    <rdf:type rdf:resource=\"http://xmlns.com/foaf/spec/Image\" />\n    <rdf:type rdf:resource=\"https://www.w3.org/ns/ma-ont#Image\" />\n<!-- Dublin Core identifier property -->\n    <dc:identifier rdf:resource=\"http://imager.mnhn.fr/imager3/w400/media/1441382723320rSt5oKNmW0bmqfJn\" />\n<!-- Dublin Core type property -->\n    <dc:type rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />  \n<!-- Dublin Core publisher property  -->\n    <dc:publisher rdf:resource=\"https://science.mnhn.fr/institution/mnhn/collection/p/item/search\" />\n<!-- Dublin Core subject property -->\n<!-- The thumbnail has two subjects -->\n<!-- The item -->\n    <dc:subject rdf:resource=\"http://coldb.mnhn.fr/catalognumber/mnhn/p/p05036298\" />\n<!-- The original media -->\n    <dc:subject rdf:resource=\"http://mediaphoto.mnhn.fr/media/1441382723320rSt5oKNmW0bmqfJn\" />\n  </rdf:Description> \n  */       \n        \n        // CETAF-style\n          for (var j in doc.message[i]) {\n            if (doc.message[i][j].type == 'StillImage') {\n              var media_id = doc.message[i][j].identifier;\n\n              // link to data\n              triples.push(triple(subject_id,\n                'http://rs.tdwg.org/dwc/terms/associatedMedia',\n                media_id));\n\n              triples.push(triple(media_id,\n                'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n                'http://purl.org/dc/dcmitype/StillImage'));\n                \n              for (var k in doc.message[i][j]) {\n                switch (k) {\n                  case 'format':\n                    triples.push(triple(media_id,\n                      'http://purl.org/dc/terms/' + k,\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'title':\n                    triples.push(triple(media_id,\n                      'http://purl.org/dc/terms/' + k,\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'description':\n                    triples.push(triple(media_id,\n                      'http://purl.org/dc/terms/' + k,\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'references':\n                    triples.push(triple(media_id,\n                      'http://purl.org/dc/terms/subject',\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'identifier':\n                    triples.push(triple(media_id,\n                      'http://purl.org/dc/terms/' + k,\n                      doc.message[i][j][k]));\n                     break;\n\n                  case 'creator':\n                    triples.push(triple(media_id,\n                      'http://purl.org/dc/terms/' + k,\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'license':\n                    triples.push(triple(media_id,\n                       'http://purl.org/dc/terms/' + k,\n                      doc.message[i][j][k]));\n                    break;\n\n\n                  default:\n                    break;\n                }\n              }\n            }\n          }\n                 \n        \n        \t// schema.org\n        \t/*\n          for (var j in doc.message[i]) {\n            if (doc.message[i][j].type == 'StillImage') {\n              var media_id = doc.message[i][j].identifier;\n\n              // link to data\n              triples.push(triple(media_id,\n                'http://schema.org/about',\n                subject_id));\n\n\n              triples.push(triple(media_id,\n                'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n                'http://schema.org/ImageObject'));\n\n              for (var k in doc.message[i][j]) {\n                switch (k) {\n                  case 'format':\n                    triples.push(triple(media_id,\n                      'http://schema.org/fileFormat',\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'title':\n                    triples.push(triple(media_id,\n                      'http://schema.org/caption',\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'description':\n                    triples.push(triple(media_id,\n                      'http://schema.org/caption',\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'references':\n                    triples.push(triple(media_id,\n                      'http://schema.org/about',\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'identifier':\n                    triples.push(triple(media_id,\n                      'http://schema.org/identifier',\n                      doc.message[i][j][k]));\n                    triples.push(triple(media_id,\n                      'http://schema.org/contentUrl',\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'creator':\n                    triples.push(triple(media_id,\n                      'http://schema.org/creator',\n                      doc.message[i][j][k]));\n                    break;\n\n                  case 'license':\n                    triples.push(triple(media_id,\n                      'http://schema.org/license',\n                      doc.message[i][j][k]));\n                    break;\n\n\n                  default:\n                    break;\n                }\n              }\n            }\n          }\n          */\n          break;  \n          \n          // Darwin Core Identification----------------------------------------------------------\n        case \"kingdom\":\n        case \"phylum\":\n        case \"order\":\n        case \"class\":\n        case \"family\":\n        case \"genus\":\n        case \"species\":\n        case 'scientificName': // convenience\n        case 'identificationQualifier':\n        case 'typeStatus':\n        case 'identifiedBy':\n        case 'dateIdentified':\n        case 'identificationReferences':\n        case 'identificationVerificationStatus':\n        case 'identificationRemarks':\n        case 'taxonID':\n        case 'identificationID': \n          triples.push(triple(subject_id,\n            'http://rs.tdwg.org/dwc/terms/' + i,\n            String(doc.message[i])));\n          break;                  \t  \n\t\t  \n\t\t\tdefault:\n\t\t\t\tbreak;\n       \t\t}\n    \t}\n\t}\n\t\t    \n\n                \n    output(doc, triples);\n\n}\n\nfunction (doc) {\n   if (doc._id.match(/gbif.org/)) {\n\tmessage(doc);\n   }\n}\n// END COUCHDB VIEW\n\n"
    }
  },
  "language": "javascript"
}
<?php

error_reporting(E_ALL);


//----------------------------------------------------------------------------------------
function get_redirect($url)
{
	$redirect = '';
	
	$opts = array(
	  CURLOPT_URL =>$url,
	  CURLOPT_FOLLOWLOCATION => FALSE,
	  CURLOPT_RETURNTRANSFER => TRUE,
	  CURLOPT_HEADER		 => TRUE
	);
	
	$ch = curl_init();
	curl_setopt_array($ch, $opts);
	$data = curl_exec($ch);
	$info = curl_getinfo($ch); 
	curl_close($ch);
	
	//print_r($info);

	$http_code = $info['http_code'];
	
	if ($http_code == 303)
	{
		$redirect = $info['redirect_url'];
	}
	
	if ($http_code == 302)
	{
		$redirect = $info['redirect_url'];
	}
	
	return $redirect;
}

//----------------------------------------------------------------------------------------
function get($url)
{
	$data = null;
	
	$opts = array(
	  CURLOPT_URL =>$url,
	  CURLOPT_FOLLOWLOCATION => TRUE,
	  CURLOPT_RETURNTRANSFER => TRUE
	);
	
	$ch = curl_init();
	curl_setopt_array($ch, $opts);
	$data = curl_exec($ch);
	$info = curl_getinfo($ch); 
	curl_close($ch);
	
	return $data;
}


$issn = '0366-4457';

$issns = array(
'1673-5102',
'0366-1326',
'1000-470X',
);

$issns=array(
"0001-5350",
"0001-6799",
"0001-6977",
"0001-804X",
"0002-8444",
"0002-9122",
"0003-0031",
"0003-0252",
"0003-049X",
"0003-3847",
"0004-2625",
"0005-8041",
"0006-324X",
"0006-5196",
"0006-6982",
"0006-8063",
"0006-8071",
"0006-808X",
"0006-8098",
"0006-8101",
"0006-8128",
"0006-8136",
"0006-8152",
"0006-8179",
"0006-8187",
"0006-8195",
"0006-8241",
"0007-196X",
"0007-9367",
"0008-4026",
"0008-7475",
"0008-8692",
"0010-0730",
"0011-6211",
"0011-6793",
"0011-9970",
"0014-8962",
"0015-0746",
"0015-5551",
"0016-5301",
"0016-6707",
"0017-3134",
"0017-3614",
"0021-7662",
"0022-2062",
"0022-4618",
"0024-4074",
"0024-9637",
"0025-1291",
"0026-279X",
"0026-6493",
"0028-825X",
"0029-8948",
"0030-8870",
"0031-7683",
"0031-9430",
"0034-365X",
"0035-4902",
"0035-919X",
"0035-922X",
"0036-1488",
"0037-8941",
"0037-9557",
"0038-4909",
"0039-646X",
"0040-0262",
"0040-9618",
"0041-1752",
"0041-8285",
"0042-5184",
"0042-5672",
"0043-0439",
"0043-1532",
"0044-5967",
"0044-5983",
"0045-0782",
"0065-1370",
"0067-0464",
"0067-1924",
"0067-4605",
"0068-2292",
"0068-5461",
"0068-547X",
"0071-5778",
"0071-5794",
"0073-2877",
"0073-4705",
"0075-5974",
"0077-1813",
"0077-2216",
"0077-8923",
"0077-8931",
"0078-5237",
"0078-9755",
"0079-1466",
"0079-2047",
"0080-4274",
"0080-469X",
"0080-5947",
"0080-9462",
"0081-024X",
"0083-6133",
"0083-7792",
"0084-2648",
"0084-5647",
"0084-5906",
"0084-800X",
"0085-4417",
"0091-1860",
"0096-2759",
"0096-6134",
"0096-8749",
"0097-1618",
"0097-3157",
"0097-3807",
"0097-4463",
"0100-4123",
"0100-8404",
"0102-3306",
"0103-2550",
"0103-5207",
"0107-055X",
"0115-0553",
"0120-1433",
"0150-9314",
"0155-4131",
"0161-1542",
"0169-5754",
"0177-0349",
"0181-1797",
"0185-254X",
"0187-7054",
"0187-7151",
"0190-9215",
"0195-6094",
"0197-4033",
"0199-9818",
"0210-6205",
"0210-9506",
"0211-1322",
"0212-0623",
"0233-187X",
"0236-6495",
"0240-8937",
"0252-1911",
"0252-192X",
"0253-1453",
"0253-2700",
"0253-5696",
"0254-6299",
"0254-6442",
"0255-0105",
"0255-9676",
"0256-5617",
"0258-1485",
"0260-9533",
"0265-086X",
"0271-5716",
"0289-3568",
"0300-1156",
"0301-2123",
"0302-2439",
"0303-9153",
"0304-3584",
"0304-3770",
"0305-0270",
"0305-7364",
"0308-0838",
"0312-9764",
"0313-4083",
"0313-4245",
"0361-185X",
"0363-6445",
"0365-0588",
"0365-0812",
"0365-4508",
"0366-1326",
"0366-2128",
"0366-3094",
"0366-3469",
"0366-4457",
"0366-5232",
"0368-2927",
"0370-0208",
"0370-047X",
"0370-1646",
"0370-3681",
"0370-3908",
"0370-5412",
"0370-6583",
"0370-7504",
"0372-1426",
"0372-333X",
"0372-4123",
"0372-4611",
"0373-2967",
"0373-2975",
"0373-4269",
"0373-4293",
"0374-5481",
"0374-6313",
"0374-6607",
"0374-7859",
"0374-8081",
"0374-9223",
"0375-1147",
"0375-121X",
"0376-1649",
"0376-4443",
"0378-2697",
"0440-5757",
"0451-9930",
"0452-9987",
"0495-3843",
"0511-4780",
"0511-9618",
"0524-0476",
"0524-5826",
"0526-717X",
"0529-1526",
"0568-5435",
"0581-7897",
"0724-312X",
"0735-8032",
"0737-8211",
"0748-3007",
"0766-7248",
"0778-4031",
"0810-6908",
"0852-8756",
"0866-7160",
"0870-0915",
"0883-1475",
"0889-258X",
"0893-3138",
"0939-5075",
"0944-0178",
"0946-9575",
"0960-4286",
"0962-8436",
"0968-0446",
"0971-2313",
"0974-7893",
"0976-5069",
"1000-2006",
"1000-3142",
"1000-4025",
"1000-470X",
"1000-6567",
"1005-3395",
"1015-8707",
"1024-0306",
"1026-1613",
"1028-2092",
"1029-0729",
"1030-1887",
"1043-4534",
"1055-3177",
"1055-7903",
"1058-5893",
"1070-0048",
"1075-3524",
"1097-993X",
"1126-3504",
"1133-6889",
"1138-5952",
"1148-8425",
"1179-3155",
"1225-8318",
"1253-8078",
"1256-4060",
"1280-8202",
"1280-8571",
"1300-008X",
"1308-8084",
"1314-2011",
"1314-2828",
"1346-6852",
"1346-7565",
"1355-4905",
"1370-6233",
"1374-7886",
"1405-6550",
"1409-3871",
"1436-2317",
"1439-6092",
"1448-9570",
"1511-8916",
"1560-7259",
"1561-0837",
"1561-882X",
"1562-7217",
"1626-3596",
"1641-8190",
"1659-3049",
"1664-2201",
"1669-4309",
"1673-5102",
"1674-4918",
"1684-5315",
"1783-0362",
"1800-427X",
"1808-2688",
"1809-5348",
"1815-8242",
"1817-406X",
"1819-0154",
"1832-536X",
"1867-9315",
"1869-6155",
"1870-3453",
"1881-9060",
"1897-2810",
"1932-6203",
"1934-5259",
"1945-9432",
"1945-9459",
"1945-9483",
"1954-6475",
"1954-6483",
"1988-4257",
"1999-3110",
"2007-4298",
"2032-3913",
"2042-3489",
"2076-3190",
"2095-0837",
"2095-0845",
"2118-9773",
"2153-733X",
"2156-0382",
"2191-3099",
"2202-0802",
"2223-7747",
"2262-9017",
"2304-7534",
"2327-2929",
"2352-5754",
"2398-6336",
"2414-8814",
"2985-8844",
"8755-4801",
);

$issns=array(
"0001-3765",
"0001-6209",
"0001-6977",
"0002-9122",
"0003-0031",
"0003-3847",
"0003-6072",
"0006-8055",
"0006-8071",
"0006-808X",
"0006-8241",
"0007-1536",
"0007-196X",
"0007-2745",
"0008-4026",
"0008-4166",
"0008-7475",
"0009-9716",
"0014-8962",
"0015-0746",
"0020-7713",
"0021-7662",
"0022-1260",
"0022-2011",
"0022-2062",
"0024-2829",
"0024-4066",
"0024-4074",
"0026-3648",
"0026-6493",
"0027-5514",
"0027-5522",
"0028-646X",
"0028-825X",
"0029-0289",
"0029-5035",
"0031-1820",
"0031-5850",
"0031-949X",
"0033-1821",
"0034-6667",
"0034-7744",
"0035-919X",
"0036-9276",
"0037-8437",
"0037-8941",
"0040-0262",
"0040-9618",
"0044-5983",
"0065-1583",
"0067-1924",
"0067-8066",
"0074-0276",
"0075-5974",
"0077-1813",
"0078-2238",
"0082-0598",
"0083-6133",
"0083-7792",
"0093-4666",
"0095-1137",
"0097-3807",
"0100-008X",
"0102-3306",
"0106-1054",
"0107-055X",
"0160-8843",
"0166-0616",
"0170-110X",
"0181-1584",
"0181-1916",
"0191-6122",
"0214-140X",
"0236-6495",
"0239-751X",
"0253-2700",
"0254-6299",
"0256-1883",
"0291-8420",
"0300-1156",
"0301-486X",
"0301-7001",
"0312-9764",
"0313-4083",
"0323-5408",
"0363-6445",
"0366-1326",
"0368-2927",
"0372-333X",
"0372-4123",
"0373-0875",
"0373-2967",
"0374-6313",
"0378-2697",
"0394-9125",
"0394-9486",
"0395-7527",
"0511-9618",
"0723-2020",
"0732-8893",
"0737-8211",
"0747-9859",
"0815-3191",
"0929-1873",
"0932-4739",
"0953-7562",
"0954-1020",
"0960-4286",
"0968-0446",
"0974-7893",
"0976-5069",
"1021-2450",
"1030-1887",
"1043-4534",
"1055-7903",
"1066-5234",
"1095-5674",
"1130-1406",
"1179-3155",
"1211-0981",
"1229-8093",
"1300-008X",
"1314-4057",
"1319-562X",
"1322-0829",
"1328-4401",
"1340-3540",
"1374-7886",
"1436-2317",
"1438-9134",
"1439-6092",
"1466-5026",
"1468-1641",
"1477-2000",
"1521-9437",
"1522-239X",
"1560-2745",
"1560-7259",
"1567-1356",
"1574-6968",
"1617-416X",
"1641-8190",
"1672-6472",
"1867-0911",
"1878-6146",
"1888-7066",
"1916-2804",
"1932-6203",
"1941-7519",
"1983-2052",
"2032-3921",
"2036-7953",
"2045-2322",
"2049-2375",
"2077-7019",
"2210-6340",
"2229-2225",
"2327-2929",
"2353-074X",
);


// CouchDB data
if (1)
{
	$json = '{
    "rows": [
        {
            "key": "0001-3765",
            "value": 1
        },
        {
            "key": "0002-2993",
            "value": 1
        },
        {
            "key": "0002-7014",
            "value": 1
        },
        {
            "key": "0002-8444",
            "value": 20
        },
        {
            "key": "0002-9122",
            "value": 62
        },
        {
            "key": "0003-0031",
            "value": 3
        },
        {
            "key": "0003-0090",
            "value": 1
        },
        {
            "key": "0003-049X",
            "value": 1
        },
        {
            "key": "0003-3847",
            "value": 4
        },
        {
            "key": "0003-4312",
            "value": 1
        },
        {
            "key": "0003-4320",
            "value": 1
        },
        {
            "key": "0003-9284",
            "value": 1
        },
        {
            "key": "0004-2625",
            "value": 23
        },
        {
            "key": "0005-6219",
            "value": 1
        },
        {
            "key": "0006-3207",
            "value": 1
        },
        {
            "key": "0006-324X",
            "value": 11
        },
        {
            "key": "0006-3568",
            "value": 1
        },
        {
            "key": "0006-3606",
            "value": 6
        },
        {
            "key": "0006-5196",
            "value": 13
        },
        {
            "key": "0006-8055",
            "value": 7
        },
        {
            "key": "0006-8063",
            "value": 1
        },
        {
            "key": "0006-8071",
            "value": 10
        },
        {
            "key": "0006-808X",
            "value": 2
        },
        {
            "key": "0006-8098",
            "value": 5
        },
        {
            "key": "0006-8101",
            "value": 7
        },
        {
            "key": "0006-8136",
            "value": 4
        },
        {
            "key": "0006-8152",
            "value": 8
        },
        {
            "key": "0006-8179",
            "value": 4
        },
        {
            "key": "0006-8195",
            "value": 2
        },
        {
            "key": "0006-8241",
            "value": 5
        },
        {
            "key": "0007-196X",
            "value": 96
        },
        {
            "key": "0007-2745",
            "value": 8
        },
        {
            "key": "0008-4026",
            "value": 8
        },
        {
            "key": "0008-8692",
            "value": 2
        },
        {
            "key": "0011-5266",
            "value": 1
        },
        {
            "key": "0011-6211",
            "value": 1
        },
        {
            "key": "0011-6793",
            "value": 17
        },
        {
            "key": "0012-821X",
            "value": 1
        },
        {
            "key": "0012-9658",
            "value": 2
        },
        {
            "key": "0013-0001",
            "value": 1
        },
        {
            "key": "0013-6220",
            "value": 1
        },
        {
            "key": "0014-0015",
            "value": 1
        },
        {
            "key": "0014-3820",
            "value": 7
        },
        {
            "key": "0014-8962",
            "value": 6
        },
        {
            "key": "0015-0746",
            "value": 20
        },
        {
            "key": "0015-0754",
            "value": 1
        },
        {
            "key": "0016-5301",
            "value": 1
        },
        {
            "key": "0016-6707",
            "value": 1
        },
        {
            "key": "0016-6731",
            "value": 3
        },
        {
            "key": "0016-7738",
            "value": 1
        },
        {
            "key": "0017-3614",
            "value": 4
        },
        {
            "key": "0018-067X",
            "value": 1
        },
        {
            "key": "0019-2252",
            "value": 1
        },
        {
            "key": "0019-4816",
            "value": 1
        },
        {
            "key": "0022-0477",
            "value": 3
        },
        {
            "key": "0022-0957",
            "value": 1
        },
        {
            "key": "0022-2062",
            "value": 7
        },
        {
            "key": "0022-2917",
            "value": 2
        },
        {
            "key": "0022-409X",
            "value": 1
        },
        {
            "key": "0023-3374",
            "value": 2
        },
        {
            "key": "0024-4066",
            "value": 1
        },
        {
            "key": "0024-4074",
            "value": 23
        },
        {
            "key": "0024-5461",
            "value": 4
        },
        {
            "key": "0024-9637",
            "value": 11
        },
        {
            "key": "0025-1291",
            "value": 1
        },
        {
            "key": "0026-279X",
            "value": 3
        },
        {
            "key": "0026-3680",
            "value": 1
        },
        {
            "key": "0026-6493",
            "value": 62
        },
        {
            "key": "0027-5123",
            "value": 1
        },
        {
            "key": "0027-8424",
            "value": 1
        },
        {
            "key": "0028-0011",
            "value": 1
        },
        {
            "key": "0028-0836",
            "value": 3
        },
        {
            "key": "0028-646X",
            "value": 3
        },
        {
            "key": "0028-825X",
            "value": 2
        },
        {
            "key": "0029-344X",
            "value": 1
        },
        {
            "key": "0029-8948",
            "value": 1
        },
        {
            "key": "0030-6053",
            "value": 1
        },
        {
            "key": "0030-8870",
            "value": 2
        },
        {
            "key": "0031-7683",
            "value": 1
        },
        {
            "key": "0031-9422",
            "value": 2
        },
        {
            "key": "0031-9430",
            "value": 14
        },
        {
            "key": "0031-9449",
            "value": 2
        },
        {
            "key": "0032-079X",
            "value": 1
        },
        {
            "key": "0032-7786",
            "value": 1
        },
        {
            "key": "0033-3174",
            "value": 1
        },
        {
            "key": "0033-5770",
            "value": 1
        },
        {
            "key": "0034-6667",
            "value": 2
        },
        {
            "key": "0034-7108",
            "value": 2
        },
        {
            "key": "0034-7744",
            "value": 2
        },
        {
            "key": "0035-4902",
            "value": 24
        },
        {
            "key": "0035-922X",
            "value": 1
        },
        {
            "key": "0036-8075",
            "value": 4
        },
        {
            "key": "0037-8437",
            "value": 1
        },
        {
            "key": "0037-850X",
            "value": 1
        },
        {
            "key": "0037-9557",
            "value": 2
        },
        {
            "key": "0037-9611",
            "value": 1
        },
        {
            "key": "0038-4909",
            "value": 2
        },
        {
            "key": "0038-9153",
            "value": 1
        },
        {
            "key": "0039-646X",
            "value": 6
        },
        {
            "key": "0039-7989",
            "value": 1
        },
        {
            "key": "0040-0262",
            "value": 57
        },
        {
            "key": "0040-5752",
            "value": 1
        },
        {
            "key": "0040-9618",
            "value": 5
        },
        {
            "key": "0042-658X",
            "value": 1
        },
        {
            "key": "0043-0439",
            "value": 5
        },
        {
            "key": "0043-0927",
            "value": 1
        },
        {
            "key": "0043-1532",
            "value": 1
        },
        {
            "key": "0043-1745",
            "value": 1
        },
        {
            "key": "0044-376X",
            "value": 1
        },
        {
            "key": "0044-5967",
            "value": 6
        },
        {
            "key": "0044-5983",
            "value": 4
        },
        {
            "key": "0047-4746",
            "value": 2
        },
        {
            "key": "0065-6275",
            "value": 3
        },
        {
            "key": "0066-4162",
            "value": 3
        },
        {
            "key": "0067-1924",
            "value": 3
        },
        {
            "key": "0067-2238",
            "value": 1
        },
        {
            "key": "0068-547X",
            "value": 6
        },
        {
            "key": "0068-6395",
            "value": 1
        },
        {
            "key": "0070-6728",
            "value": 1
        },
        {
            "key": "0071-3260",
            "value": 1
        },
        {
            "key": "0071-5786",
            "value": 1
        },
        {
            "key": "0071-5794",
            "value": 1
        },
        {
            "key": "0071-6154",
            "value": 1
        },
        {
            "key": "0072-0879",
            "value": 1
        },
        {
            "key": "0073-6767",
            "value": 1
        },
        {
            "key": "0074-0276",
            "value": 1
        },
        {
            "key": "0075-5974",
            "value": 22
        },
        {
            "key": "0075-7314",
            "value": 1
        },
        {
            "key": "0075-9481",
            "value": 1
        },
        {
            "key": "0076-8227",
            "value": 2
        },
        {
            "key": "0077-2216",
            "value": 1
        },
        {
            "key": "0077-8923",
            "value": 1
        },
        {
            "key": "0077-8931",
            "value": 33
        },
        {
            "key": "0078-1312",
            "value": 2
        },
        {
            "key": "0078-5237",
            "value": 2
        },
        {
            "key": "0078-9739",
            "value": 1
        },
        {
            "key": "0080-0694",
            "value": 8
        },
        {
            "key": "0080-4274",
            "value": 1
        },
        {
            "key": "0081-024X",
            "value": 6
        },
        {
            "key": "0083-6133",
            "value": 1
        },
        {
            "key": "0083-7792",
            "value": 3
        },
        {
            "key": "0084-2648",
            "value": 2
        },
        {
            "key": "0084-5906",
            "value": 2
        },
        {
            "key": "0084-800X",
            "value": 5
        },
        {
            "key": "0085-4417",
            "value": 2
        },
        {
            "key": "0091-1860",
            "value": 12
        },
        {
            "key": "0094-8373",
            "value": 1
        },
        {
            "key": "0095-8840",
            "value": 2
        },
        {
            "key": "0096-2783",
            "value": 1
        },
        {
            "key": "0097-0271",
            "value": 1
        },
        {
            "key": "0097-1618",
            "value": 5
        },
        {
            "key": "0097-3157",
            "value": 3
        },
        {
            "key": "0097-6857",
            "value": 1
        },
        {
            "key": "0099-4065",
            "value": 1
        },
        {
            "key": "0100-1329",
            "value": 1
        },
        {
            "key": "0100-8404",
            "value": 5
        },
        {
            "key": "0100-8455",
            "value": 1
        },
        {
            "key": "0102-3306",
            "value": 10
        },
        {
            "key": "0103-2542",
            "value": 1
        },
        {
            "key": "0103-2550",
            "value": 3
        },
        {
            "key": "0103-9121",
            "value": 1
        },
        {
            "key": "0107-055X",
            "value": 12
        },
        {
            "key": "0110-6465",
            "value": 2
        },
        {
            "key": "0120-4351",
            "value": 1
        },
        {
            "key": "0133-6215",
            "value": 1
        },
        {
            "key": "0138-4988",
            "value": 1
        },
        {
            "key": "0140-1963",
            "value": 2
        },
        {
            "key": "0150-9314",
            "value": 1
        },
        {
            "key": "0161-1542",
            "value": 8
        },
        {
            "key": "0167-4412",
            "value": 1
        },
        {
            "key": "0169-3867",
            "value": 1
        },
        {
            "key": "0172-6668",
            "value": 3
        },
        {
            "key": "0176-7038",
            "value": 1
        },
        {
            "key": "0187-7151",
            "value": 3
        },
        {
            "key": "0191-3999",
            "value": 2
        },
        {
            "key": "0193-4511",
            "value": 2
        },
        {
            "key": "0195-6094",
            "value": 16
        },
        {
            "key": "0196-3031",
            "value": 1
        },
        {
            "key": "0197-4033",
            "value": 1
        },
        {
            "key": "0210-1475",
            "value": 1
        },
        {
            "key": "0210-8984",
            "value": 1
        },
        {
            "key": "0210-9506",
            "value": 1
        },
        {
            "key": "0211-1322",
            "value": 14
        },
        {
            "key": "0212-9108",
            "value": 1
        },
        {
            "key": "0213-4039",
            "value": 1
        },
        {
            "key": "0215-8906",
            "value": 1
        },
        {
            "key": "0240-8937",
            "value": 1
        },
        {
            "key": "0253-1453",
            "value": 3
        },
        {
            "key": "0253-2700",
            "value": 2
        },
        {
            "key": "0254-6299",
            "value": 3
        },
        {
            "key": "0254-6442",
            "value": 5
        },
        {
            "key": "0256-5595",
            "value": 1
        },
        {
            "key": "0256-5617",
            "value": 1
        },
        {
            "key": "0258-1485",
            "value": 1
        },
        {
            "key": "0258-8900",
            "value": 1
        },
        {
            "key": "0266-4674",
            "value": 3
        },
        {
            "key": "0277-3791",
            "value": 1
        },
        {
            "key": "0300-3701",
            "value": 3
        },
        {
            "key": "0302-2439",
            "value": 1
        },
        {
            "key": "0302-9417",
            "value": 1
        },
        {
            "key": "0303-9153",
            "value": 2
        },
        {
            "key": "0304-3711",
            "value": 1
        },
        {
            "key": "0305-0270",
            "value": 1
        },
        {
            "key": "0305-1978",
            "value": 2
        },
        {
            "key": "0305-7364",
            "value": 12
        },
        {
            "key": "0309-1333",
            "value": 1
        },
        {
            "key": "0312-9764",
            "value": 5
        },
        {
            "key": "0313-4083",
            "value": 1
        },
        {
            "key": "0325-3732",
            "value": 2
        },
        {
            "key": "0326-2383",
            "value": 1
        },
        {
            "key": "0340-269X",
            "value": 30
        },
        {
            "key": "0341-0145",
            "value": 1
        },
        {
            "key": "0346-4601",
            "value": 1
        },
        {
            "key": "0347-8742",
            "value": 6
        },
        {
            "key": "0361-185X",
            "value": 1
        },
        {
            "key": "0363-6445",
            "value": 49
        },
        {
            "key": "0365-4508",
            "value": 1
        },
        {
            "key": "0365-7116",
            "value": 1
        },
        {
            "key": "0365-9631",
            "value": 1
        },
        {
            "key": "0366-2128",
            "value": 2
        },
        {
            "key": "0366-4457",
            "value": 1
        },
        {
            "key": "0366-5232",
            "value": 2
        },
        {
            "key": "0366-7634",
            "value": 1
        },
        {
            "key": "0367-2530",
            "value": 3
        },
        {
            "key": "0368-7198",
            "value": 1
        },
        {
            "key": "0370-0461",
            "value": 1
        },
        {
            "key": "0370-047X",
            "value": 2
        },
        {
            "key": "0370-3908",
            "value": 7
        },
        {
            "key": "0370-6583",
            "value": 4
        },
        {
            "key": "0370-7415",
            "value": 1
        },
        {
            "key": "0370-7504",
            "value": 1
        },
        {
            "key": "0372-0578",
            "value": 1
        },
        {
            "key": "0372-4611",
            "value": 1
        },
        {
            "key": "0373-0581",
            "value": 1
        },
        {
            "key": "0373-2967",
            "value": 6
        },
        {
            "key": "0373-465X",
            "value": 1
        },
        {
            "key": "0373-580X",
            "value": 4
        },
        {
            "key": "0374-5481",
            "value": 1
        },
        {
            "key": "0374-6577",
            "value": 4
        },
        {
            "key": "0374-7778",
            "value": 5
        },
        {
            "key": "0374-9606",
            "value": 1
        },
        {
            "key": "0375-1651",
            "value": 3
        },
        {
            "key": "0376-2793",
            "value": 1
        },
        {
            "key": "0376-8929",
            "value": 1
        },
        {
            "key": "0378-1844",
            "value": 1
        },
        {
            "key": "0378-2697",
            "value": 16
        },
        {
            "key": "0385-4655",
            "value": 1
        },
        {
            "key": "0511-9618",
            "value": 6
        },
        {
            "key": "0529-1526",
            "value": 10
        },
        {
            "key": "0548-1686",
            "value": 1
        },
        {
            "key": "0556-3321",
            "value": 2
        },
        {
            "key": "0567-7572",
            "value": 2
        },
        {
            "key": "0568-5443",
            "value": 1
        },
        {
            "key": "0735-8032",
            "value": 1
        },
        {
            "key": "0737-4038",
            "value": 3
        },
        {
            "key": "0737-8211",
            "value": 5
        },
        {
            "key": "0743-9547",
            "value": 1
        },
        {
            "key": "0748-3007",
            "value": 8
        },
        {
            "key": "0778-4031",
            "value": 1
        },
        {
            "key": "0792-9978",
            "value": 2
        },
        {
            "key": "0870-6352",
            "value": 1
        },
        {
            "key": "0883-0351",
            "value": 1
        },
        {
            "key": "0883-1475",
            "value": 11
        },
        {
            "key": "0885-4637",
            "value": 3
        },
        {
            "key": "0888-8892",
            "value": 1
        },
        {
            "key": "0889-258X",
            "value": 2
        },
        {
            "key": "0889-874X",
            "value": 2
        },
        {
            "key": "0894-8364",
            "value": 1
        },
        {
            "key": "0894-8399",
            "value": 1
        },
        {
            "key": "0913-557X",
            "value": 1
        },
        {
            "key": "0918-9440",
            "value": 3
        },
        {
            "key": "0924-8323",
            "value": 1
        },
        {
            "key": "0932-8629",
            "value": 1
        },
        {
            "key": "0939-6314",
            "value": 1
        },
        {
            "key": "0944-0178",
            "value": 1
        },
        {
            "key": "0950-5709",
            "value": 1
        },
        {
            "key": "0960-3115",
            "value": 4
        },
        {
            "key": "0960-4286",
            "value": 8
        },
        {
            "key": "0960-7412",
            "value": 1
        },
        {
            "key": "0962-8452",
            "value": 1
        },
        {
            "key": "0971-2313",
            "value": 3
        },
        {
            "key": "0996-6625",
            "value": 2
        },
        {
            "key": "1000-3142",
            "value": 2
        },
        {
            "key": "1010-061X",
            "value": 2
        },
        {
            "key": "1012-9987",
            "value": 1
        },
        {
            "key": "1013-4255",
            "value": 1
        },
        {
            "key": "1015-4442",
            "value": 1
        },
        {
            "key": "1029-8649",
            "value": 1
        },
        {
            "key": "1030-1887",
            "value": 7
        },
        {
            "key": "1034-1218",
            "value": 1
        },
        {
            "key": "1043-4534",
            "value": 8
        },
        {
            "key": "1046-8021",
            "value": 1
        },
        {
            "key": "1052-3669",
            "value": 4
        },
        {
            "key": "1055-3177",
            "value": 42
        },
        {
            "key": "1055-7903",
            "value": 12
        },
        {
            "key": "1058-5893",
            "value": 3
        },
        {
            "key": "1061-4036",
            "value": 1
        },
        {
            "key": "1063-5157",
            "value": 7
        },
        {
            "key": "1075-5535",
            "value": 1
        },
        {
            "key": "1087-1950",
            "value": 1
        },
        {
            "key": "1096-0031",
            "value": 1
        },
        {
            "key": "1097-993X",
            "value": 2
        },
        {
            "key": "1175-5636",
            "value": 1
        },
        {
            "key": "1211-9520",
            "value": 1
        },
        {
            "key": "1280-8202",
            "value": 1
        },
        {
            "key": "1280-8571",
            "value": 3
        },
        {
            "key": "1300-008X",
            "value": 1
        },
        {
            "key": "1300-932X",
            "value": 6
        },
        {
            "key": "1314-2011",
            "value": 1
        },
        {
            "key": "1365-294X",
            "value": 1
        },
        {
            "key": "1367-4803",
            "value": 2
        },
        {
            "key": "1402-2001",
            "value": 1
        },
        {
            "key": "1433-8319",
            "value": 1
        },
        {
            "key": "1435-1935",
            "value": 1
        },
        {
            "key": "1438-9134",
            "value": 1
        },
        {
            "key": "1439-6092",
            "value": 1
        },
        {
            "key": "1442-9985",
            "value": 1
        },
        {
            "key": "1464-7931",
            "value": 1
        },
        {
            "key": "1467-8748",
            "value": 3
        },
        {
            "key": "1469-8137",
            "value": 2
        },
        {
            "key": "1471-2970",
            "value": 1
        },
        {
            "key": "1476-4687",
            "value": 2
        },
        {
            "key": "1511-1121",
            "value": 1
        },
        {
            "key": "1519-6984",
            "value": 1
        },
        {
            "key": "1526-2383",
            "value": 1
        },
        {
            "key": "1531-6912",
            "value": 1
        },
        {
            "key": "1558-5646",
            "value": 1
        },
        {
            "key": "1561-0837",
            "value": 2
        },
        {
            "key": "1673-5102",
            "value": 2
        },
        {
            "key": "1674-4918",
            "value": 1
        },
        {
            "key": "1752-4571",
            "value": 1
        },
        {
            "key": "1809-4392",
            "value": 1
        },
        {
            "key": "1817-406X",
            "value": 1
        },
        {
            "key": "1916-2804",
            "value": 19
        },
        {
            "key": "1932-6203",
            "value": 1
        },
        {
            "key": "1934-5259",
            "value": 2
        },
        {
            "key": "1936-6434",
            "value": 1
        },
        {
            "key": "2175-7860",
            "value": 7
        },
        {
            "key": "2235-3658",
            "value": 4
        },
        {
            "key": "2236-8906",
            "value": 2
        }
    ]
}';

	$obj = json_decode($json);
	
	$issns = array();
	
	foreach ($obj->rows as $row)
	{
		$issns[] = $row->key;
	}
}


$force = false;

$count = 1;

$extension = '.nt';

//$extension = '.jsonld';


foreach ($issns as $issn)
{
	$filename = dirname(__FILE__) . '/cache/' . $issn . $extension;
	
	if (file_exists($filename) && !$force )
	{
		// done
		echo "Have $issn\n";
	}
	else
	{
		echo "Fetching $issn\n";
	



		$url = 'https://www.worldcat.org/issn/' . $issn;

		$redirect =  get_redirect($url);

		if (preg_match('/oclc\/(?<oclc>\d+)/', $redirect, $m))
		{
		
			$url = 'http://www.worldcat.org/oclc/' . $m['oclc'] . $extension;

			$data = get($url);
			
			file_put_contents($filename, $data);
		}
	
		// Give server a break every 10 items
		if (($count++ % 10) == 0)
		{
			$rand = rand(1000000, 3000000);
			echo "\n# sleeping for " . round(($rand / 1000000),2) . ' seconds' . "\n\n";
			usleep($rand);
		}
	}	
	
}

?>
